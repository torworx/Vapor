# This file controls what file are to be put on classpath or command line.
#
# Format is as follows:
#
# Each line contains entry in the format:
#
#  SUBJECT [ [!] CONDITION [AND|OR] ]*
# 
# where SUBJECT: 
#   ends with ".class" is the Main class to run.
#   ends with ".xml" is a configuration file for the command line
#   ends with "/" is a directory from which to add all jar and zip files. 
#   ends with "/*" is a directory from which to add all unconsidered jar and zip files.
#   ends with "/**" is a directory from which to recursively add all unconsidered jar and zip files.
#   Containing = are used to assign system properties.
#   Containing ~= are used to assign start properties.
#   Containing /= are used to assign a canonical path.
#   all other subjects are treated as files to be added to the classpath.
#
# ${name} is expanded to a start property
# $(name) is expanded to either a start property or a system property. 
# The start property ${version} is defined as the version of the start.jar
#
# Files starting with "/" are considered absolute, all others are relative to
# the home directory.
#
# CONDITION is one of:
#   always
#   never
#   available classname        # true if class on classpath
#   property name              # true if set as start property
#   system   name              # true if set as system property
#   exists file                # true if file/dir exists
#   java OPERATOR version      # java version compared to literal
#   nargs OPERATOR number      # number of command line args compared to literal
#   OPERATOR := one of "<",">","<=",">=","==","!="
#
# CONTITIONS can be combined with AND OR or !, with AND being the assume
# operator for a list of CONDITIONS.
#
# Classpath operations are evaluated on the fly, so once a class or jar is
# added to the classpath, subsequent available conditions will see that class.
#
# The configuration file may be divided into sections with option names like:
# [ssl,default]
#
# Clauses after a section header will only be included if they match one of the tags in the 
# options property.  By default options are set to "default,*" or the OPTIONS property may
# be used to pass in a list of tags, eg. :
#
#    java -jar start.jar OPTIONS=vapor,jsp,ssl
#
# The tag '*' is always appended to the options, so any section with the * tag is always 
# applied.
#

# add a property defined classpath
${path}.path                                     property path

# add a property defined library directory
${lib}/**                                        exists ${lib}

# Try different settings of vapor.home until the start.jar is found.
vapor.home=.                                     ! exists $(vapor.home)/start.jar 
vapor.home=..                                    ! exists $(vapor.home)/start.jar 
vapor.home=vapor-distribution/src/main/resources     ! exists $(vapor.home)/start.jar 
vapor.home=../vapor-distribution/src/main/resources  ! exists $(vapor.home)/start.jar 
vapor.home=.                                     ! exists $(vapor.home)/start.jar
vapor.home/=$(vapor.home)                        exists $(vapor.home)/start.jar

# The main class to run
org.eclipse.vapor.xml.XmlConfiguration.class
${start.class}.class                             property start.class

# The default configuration files
$(vapor.home)/etc/vapor.xml                      nargs == 0
./vapor-server/src/main/config/etc/vapor.xml     nargs == 0 AND ! exists $(vapor.home)/etc/vapor.xml

# Default OPTIONS if not specified on the command line
OPTIONS~=default,*                               ! property OPTIONS

# Add a resources directory if it is there
[All,resources,default]
$(vapor.home)/resources/
           
# Add vapor modules
[*]
$(vapor.home)/lib/vapor-util-$(version).jar                                             ! available org.eclipse.vapor.util.StringUtil
$(vapor.home)/lib/vapor-io-$(version).jar                                               ! available org.eclipse.vapor.io.Buffer

[Server,All,xml,default]
$(vapor.home)/lib/vapor-xml-$(version).jar                                              ! available org.eclipse.vapor.xml.XmlParser
         
[Server,All,server,default]
$(vapor.home)/lib/servlet-api-3.0.jar                                                   ! available javax.servlet.ServletContext
$(vapor.home)/lib/vapor-http-$(version).jar                                             ! available org.eclipse.vapor.http.HttpParser
$(vapor.home)/lib/vapor-continuation-$(version).jar                                     ! available org.eclipse.vapor.continuation.Continuation
$(vapor.home)/lib/vapor-server-$(version).jar                                           ! available org.eclipse.vapor.server.Server
                                             
[Server,All,security,default]
$(vapor.home)/lib/vapor-security-$(version).jar                                         ! available org.eclipse.vapor.security.LoginService
                                                       
[Server,All,servlet,default]
$(vapor.home)/lib/servlet-api-3.0.jar                                                   ! available javax.servlet.ServletContext
$(vapor.home)/lib/vapor-servlet-$(version).jar                                          ! available org.eclipse.vapor.servlet.ServletHandler
                            
[Server,All,webapp,default]
$(vapor.home)/lib/vapor-webapp-$(version).jar                                           ! available org.eclipse.vapor.webapp.WebAppContext
                                  
[Server,All,deploy,default]
$(vapor.home)/lib/vapor-deploy-$(version).jar                                           ! available org.eclipse.vapor.deploy.ContextDeployer
           
[Server,All,servlets,default]
$(vapor.home)/lib/vapor-servlets-$(version).jar                                         ! available org.eclipse.vapor.servlets.WelcomeFilter

[All,rewrite]
$(vapor.home)/lib/vapor-rewrite-$(version).jar                                          ! available org.eclipse.vapor.rewrite.handler.RewriteHandler

[All,jmx]
$(vapor.home)/lib/vapor-jmx-$(version).jar                                              ! available org.eclipse.vapor.jmx.MBeanContainer
                  
[All,ajp]
$(vapor.home)/lib/vapor-ajp-$(version).jar                                              ! available org.eclipse.vapor.ajp.Ajp13Connection      
                   
[All,plus,jndi]
$(vapor.home)/lib/vapor-jndi-${version}.jar                                             ! available org.eclipse.vapor.jndi.ContextFactory
$(vapor.home)/lib/vapor-plus-${version}.jar                                             ! available org.eclipse.vapor.plus.jndi.NamingEntry
$(vapor.home)/lib/jndi/**                                                               exists $(vapor.home)/lib/jndi 

[All,annotations]
$(vapor.home)/lib/vapor-annotations-$(version).jar                                      ! available org.eclipse.vapor.annotations.AnnotationFinder
$(vapor.home)/lib/annotations/**                                                        exists $(vapor.home)/lib/jndi 
          
[All,setuid]
$(vapor.home)/lib/vapor-setuid-$(version).jar                                           ! available org.eclipse.vapor.setuid.SetUID
$(vapor.home)/lib/setuid/**                                                       
                                    
[All,policy]
$(vapor.home)/lib/vapor-policy-$(version).jar                                           ! available org.eclipse.vapor.policy.JettyPolicy
                                    
[All,Client,client]
$(vapor.home)/lib/vapor-http-$(version).jar                                             ! available org.eclipse.vapor.http.HttpParser
$(vapor.home)/lib/vapor-client-$(version).jar                                           ! available org.eclipse.vapor.client.HttpClient

[Client]
$(vapor.home)/lib/vapor-http-$(version).jar                                             ! available org.eclipse.vapor.http.HttpParser

[All,websocket]
$(vapor.home)/lib/vapor-websocket-$(version).jar                                        ! available org.eclipse.vapor.websocket.WebSocket
       
[All,overlay,overlays]
$(vapor.home)/lib/vapor-overlay-deployer-$(version).jar                                 ! available org.eclipse.vapor.overlay.OverlayedAppProvider
       
      
# Add ext if it exists
[Server,All,default,ext]        
$(vapor.home)/lib/ext/**

# Add all other sub-directories in /lib/ as options in a dynamic way
[All,=$(vapor.home)/lib/**]        

